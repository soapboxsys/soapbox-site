<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>API Design Overview</title>
    <meta name="description" content="The truth never damages a cause that is just. 
">
    <link rel="shortcut icon" href="res/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://soapbox.systems/blog/2015/10/02/api-design.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">
      <a class="site-title" href="/">
          <img id="title-logo" src="/res/soapbox-logo.png" />
      </a>
  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">API Design Overview</h1>
    <p class="post-meta">Oct 2, 2015 • Nick</p>
  </header>

  <article class="post-content">
    <h2 id="api-design-description">API Design Description</h2>

<h1 id="overview">Overview</h1>
<p>The goal of this document is to describe the intention behind and the details of a JSON API that exposes the public record over HTTP.
This document will cover the specific requirements of an open-source API that serves public statements stored in Bitcoin’s block chain.
How this software is intended to be used and how it must function is covered within.</p>

<h1 id="status-of-this-document">Status of This Document</h1>
<p>This is a draft design that is subject to change. Further documentation of the API methods themselves can be found in the source code <a href="https://github.com/soapboxsys/ombudslib">here</a>.</p>

<p>Nick – October 2015</p>

<h1 id="contents">Contents</h1>
<ol>
  <li>Definitions</li>
  <li>Introduction</li>
  <li>Requirements Overview</li>
  <li>Available Records</li>
  <li>Physical Infrastructure 
  3.1 Minimum Requirements
  3.2 Deployment Process</li>
  <li>Authenticating the Server</li>
  <li>Protecting Users
  5.1 Server Logging
  5.2 TOR hidden services</li>
  <li>DOS Resistance Tradeoffs</li>
  <li>Release Process and Updates</li>
</ol>

<h2 id="definitions">Definitions</h2>

<p>Throughout this document the pronoun “we” is occasionally used. “We” in this context means Alex Kuck and Nick Skelsey.</p>

<h2 id="introduction">Introduction</h2>

<p>The API discussed here is the interface that mobile application and web based users of Ombuds will rely on for information stored in the public record.
While it is clear that operator’s of APIs and web servers can act maliciously, for the sake of usability and scalability we have decided to build a centralized piece of core infrastructure. </p>

<p>The goal here is to produce a compact and performant JSON API that is easy for many organizations and individuals to deploy. 
That being said, the first organization to deploy it will be Soapbox Systems.
Due to size of Bitcoin’s block chain we cannot expect new participants in this system to fully join the Bitcoin network, just to have access to Ombuds.
To make our system more accessible, clients that cannot or would rather not bear the cost of deploying and maintaining there own network infrastructure can instead trust a third party to serve them relevant application data.</p>

<p>It is important to note, that the API discussed below is READ only. The only interactions with the system that are conducted through the API is the retireval of records stored in the public record. 
An SSV client can always verify that the statement is unmoddified and actually included in the record. 
However, an SSV client can not be sure of whether or not statements have been excluded from the record.
This problem along with methods to address it is discussed further in <a href="/An-Auditable-API">DD02</a>.</p>

<h2 id="requirements-overview">Requirements Overview</h2>
<p>In general the goal of this server application is that it runs on modern enterprise grade servers.
To that end it must support thousands of simulataneous clients while remaining:</p>

<ol>
  <li>Secure</li>
  <li>Available</li>
  <li>Performant</li>
  <li>Auditable</li>
</ol>

<p><code>0. Secure</code></p>

<p>Clearly, the API code must not introduce any remote code execution vulnerabilities or unintentional leaks of user or operator information.
The API server must also be resitant to DOS attacks, both from malicious peers on the Bitcoin network and SSV clients.
Finally, updates to API servers must be cryptographically authenticated.</p>

<ol>
  <li>Available Records</li>
</ol>

<p>The API will serve three fundamental things: bulletins, endorsements and inclusion proofs.
It will also serve aggregated lists of these things. 
While the exact schema and available routes of theses requests is descibed elsewhere this section describes </p>

<p>The schema of bulletins is described in appendix A of this <a href="https://getombuds.org/research">paper</a>.
The JSON format of endorsements is described in section 2.2 of <a href="/DD2">DD2</a>.
The JSON format of inclusion proofs is described in <a href="/DD3">DD3</a>.</p>

<p>3.1 Aggregates</p>

<pre><code>The API
</code></pre>

<h2 id="physical-infrastructure">5 Physical Infrastructure</h2>

<p>A properly functioning API server will have to run two binaries: ombfullnode and ombwebapi.
<code>ombfullnode</code> is a modified full node implementation of Bitcoin, while <code>ombwebapi</code> serves the JSON API over https. 
This means that a single server must meet the minimum requirements to run a Bitcoin full node <em>and</em> fulfill requests from SSV nodes.</p>

<h2 id="minimum-requirements">5.1 Minimum Requirements</h2>
<p>Be aware that this is not the recommended setup and it makes more sense to use two different machines. 
This way one machine can communicate solely with the Bitcoin network and build the public record and the other machine can respond to SSV nodes.
In any configuration of servers though, the requirements stated above still apply.</p>

<h2 id="deployment-process">5.2 Deployment Process</h2>

<p>There are two ways to set up a deployment of an API server. 
The first only requires the application binaries and a connection to the Bitcoin network.
This requires a full download and validation of the bitcoin block chain and the construction of a public record from it.</p>

<p>The second method relies on a trusted checkpoint or a friends application data to supply the initial block chain and public record.
While we don’t endorse this method of setting up an API.
We will be distributing a bootstrap file for Bitcoin’s Testnet, so that folks can test their deployments of the server API before running the real thing.
That bundle of bootstrap data will be released with new versions of the software.
The process is decribed further in <a href="">section 7.2</a>.</p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>Primary Contact</li>
          <li><a href="mailto:nick@soapbox.systems">nick@soapbox.systems</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/soapboxsys">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">soapboxsys</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/boxsoapbot">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">boxsoapbot</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">The truth never damages a cause that is just. 
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
